server {
    listen 80 default_server;
    listen [::]:80 default_server;

    root /var/www/launcher;
    index index.html;

    location = / {
        try_files /index.html =404;
    }

    location = /kitchen { return 302 /kitchen/; }
    location = /panel   { return 302 /panel/; }
    location = /system  { return 302 /system/; }

    location /system/ {
        proxy_pass http://127.0.0.1:5100/system/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /kitchen/ {
        proxy_pass http://127.0.0.1:5000/;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_set_header Accept-Encoding "";

        sub_filter_once off;
        sub_filter_types text/html text/css application/javascript;

        sub_filter 'href="/'   'href="/kitchen/';
        sub_filter 'src="/'    'src="/kitchen/';
        sub_filter 'action="/' 'action="/kitchen/';
        sub_filter 'url(/'     'url(/kitchen/';
        sub_filter "<style>" "<a href=\"/\" style=\"position:fixed;top:12px;left:12px;padding:10px 14px;border-radius:12px;background:rgba(0,0,0,.45);color:#fff;text-decoration:none;font-weight:700;z-index:99999;\">Apps</a><div style=\"height:44px\"></div><style>";

        sub_filter '<body'  '<body><a href="/" style="position:fixed;top:12px;left:12px;padding:10px 14px;border-radius:12px;background:rgba(0,0,0,.45);color:#fff;text-decoration:none;font-weight:700;z-index:99999;">Apps</a><div style="height:44px"></div>';
        sub_filter '<body>' '<body><a href="/" style="position:fixed;top:12px;left:12px;padding:10px 14px;border-radius:12px;background:rgba(0,0,0,.45);color:#fff;text-decoration:none;font-weight:700;z-index:99999;">Apps</a><div style="height:44px"></div>';
    }

    location /panel/ {
        proxy_pass http://127.0.0.1:5100/;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_set_header Accept-Encoding "";

        sub_filter_once off;
        sub_filter_types text/html text/css application/javascript;

        sub_filter 'href="/'   'href="/panel/';
        sub_filter 'src="/'    'src="/panel/';
        sub_filter 'action="/' 'action="/panel/';
        sub_filter 'url(/'     'url(/panel/';

        sub_filter '<body'  '<body><a href="/" style="position:fixed;top:12px;left:12px;padding:10px 14px;border-radius:12px;background:rgba(0,0,0,.45);color:#fff;text-decoration:none;font-weight:700;z-index:99999;">Apps</a><div style="height:44px"></div>';
        sub_filter '<body>' '<body><a href="/" style="position:fixed;top:12px;left:12px;padding:10px 14px;border-radius:12px;background:rgba(0,0,0,.45);color:#fff;text-decoration:none;font-weight:700;z-index:99999;">Apps</a><div style="height:44px"></div>';
    }
}
